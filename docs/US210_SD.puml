@startuml sd

participant "User" as A
participant "IBuildingController" as IB
participant "BuildingController" as B
participant "IBuildingsService" as IC
participant "BuildingsService" as C
participant "IBuildingsRepo" as ID
participant "BuildingsRepo" as D
participant "Building Entity" as E
participant "ConfigFile" as CONF
participant "IBuildingPersistence" as IH
participant "BuildingPersistence" as H
participant "BuildingSchema" as I
participant "FloorMap" as FM
participant "ConfigFile" as CONF

A -> IB: send request to listAllFloorsInBuilding(buildingID)
activate IB

IB -> B: listAllFloorsInBuilding(buildingID)
activate B
B -> CONF: Injects Service
activate CONF
CONF -> B
deactivate CONF
B -> IC: getAllFloorsForBuilding(buildingID)
activate IC

IC -> C: findByDomainID(buildingID)
activate C

C -> ID: findByDomainID(buildingID)
activate ID

ID -> D: findByDomainID(buildingID)
activate D

D -> IH: query as FilterQuery<IBuildingsPersistence & Document>
activate IH

IH -> H: 
activate H

H -> IH:
deactivate H

IH -> D:
deactivate IH

D -> I: findOne(query)
activate I

I --> D: return building entity
deactivate I

D --> ID: return building entity
deactivate D

ID --> C: building entity
deactivate ID
C --> E:  floorsInBuilding: Floor[] = building.floorOnBuilding
activate E
E --> C: returns building.floorOnBuilding
deactivate E
C --> FM: floorsInBuildingDTO = floorsInBuilding.map(floor => FloorMap.toDTO(floor))
activate FM
FM --> C: returns floorDTO
deactivate FM
C --> IC: return floorsInBuildingDTO
deactivate C

IC --> B: Return floorsInBuildingDTO
deactivate IC

B -> IB: Send response with status 200 and the floorsInBuildingDTO
deactivate B

IB -> A: Send response with status 200 and the floorsInBuildingDTO
deactivate IB

@enduml
